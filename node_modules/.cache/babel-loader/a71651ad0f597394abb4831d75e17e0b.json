{"remainingRequest":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js!/home/dev/work/client-auth/src/store/modules/defaults/DefaultPermissionsModule.js","dependencies":[{"path":"/home/dev/work/client-auth/src/store/modules/defaults/DefaultPermissionsModule.js","mtime":1582300395653},{"path":"/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nexport var DefaultPermissionsModule = function DefaultPermissionsModule(defaultState) {\n  _classCallCheck(this, DefaultPermissionsModule);\n\n  this.state = _objectSpread({\n    parentId: 0\n  }, defaultState());\n  this.actions = {\n    SET_PARENT_ITEM_ID: function SET_PARENT_ITEM_ID(context, id) {\n      context.commit('SET_PARENT_ITEM_ID', id);\n    },\n    LOAD_DATA_LIST: function () {\n      var _LOAD_DATA_LIST = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(context) {\n        var dataList;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!context.state.parentId) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 3;\n                return context.dispatch('LOAD_PERMISSIONS_LIST');\n\n              case 3:\n                dataList = _context.sent;\n                context.dispatch('RESET_ITEM_STATE');\n                context.commit('SET_DATA_LIST', dataList);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function LOAD_DATA_LIST(_x) {\n        return _LOAD_DATA_LIST.apply(this, arguments);\n      }\n\n      return LOAD_DATA_LIST;\n    }(),\n    SET_SIZE: function SET_SIZE(context, size) {\n      context.commit('SET_SIZE', size);\n    },\n    SET_SEARCH: function SET_SEARCH(context, search) {\n      context.commit('SET_SEARCH', search);\n    },\n    NEXT_PAGE: function NEXT_PAGE(context) {\n      if (context.state.isNextPage) {\n        context.commit('INCREMENT_PAGE');\n        context.dispatch('LOAD_DATA_LIST');\n      }\n    },\n    PREV_PAGE: function PREV_PAGE(context) {\n      if (context.state.page) {\n        context.commit('DECREMENT_PAGE');\n        context.dispatch('LOAD_DATA_LIST');\n      }\n    },\n    PATCH_ITEM_PERMISSIONS: function () {\n      var _PATCH_ITEM_PERMISSIONS = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(context, _ref) {\n        var prop, index, readState, item;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                prop = _ref.prop, index = _ref.index;\n                readState = context.state.dataList[index].access.r;\n                _context2.next = 4;\n                return context.commit('PATCH_ITEM_PERMISSIONS', {\n                  prop: prop,\n                  index: index\n                });\n\n              case 4:\n                item = [{\n                  grantee_id: context.state.dataList[index].grantee.id,\n                  access: prop\n                }];\n                if (!readState) item[0].access += 'r';\n                _context2.prev = 6;\n                _context2.next = 9;\n                return context.dispatch('PATCH_PERMISSIONS', item);\n\n              case 9:\n                _context2.next = 14;\n                break;\n\n              case 11:\n                _context2.prev = 11;\n                _context2.t0 = _context2[\"catch\"](6);\n                context.dispatch('LOAD_DATA_LIST');\n\n              case 14:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[6, 11]]);\n      }));\n\n      function PATCH_ITEM_PERMISSIONS(_x2, _x3) {\n        return _PATCH_ITEM_PERMISSIONS.apply(this, arguments);\n      }\n\n      return PATCH_ITEM_PERMISSIONS;\n    }(),\n    ADD_ITEM_ROLE: function () {\n      var _ADD_ITEM_ROLE = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(context, role) {\n        var item;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                item = [{\n                  grantee_id: role.id,\n                  access: 'r'\n                }];\n                _context3.prev = 1;\n                _context3.next = 4;\n                return context.dispatch('PATCH_PERMISSIONS', item);\n\n              case 4:\n                _context3.next = 8;\n                break;\n\n              case 6:\n                _context3.prev = 6;\n                _context3.t0 = _context3[\"catch\"](1);\n\n              case 8:\n                _context3.prev = 8;\n                context.dispatch('LOAD_DATA_LIST');\n                return _context3.finish(8);\n\n              case 11:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[1, 6, 8, 11]]);\n      }));\n\n      function ADD_ITEM_ROLE(_x4, _x5) {\n        return _ADD_ITEM_ROLE.apply(this, arguments);\n      }\n\n      return ADD_ITEM_ROLE;\n    }(),\n    RESET_ITEM_STATE: function () {\n      var _RESET_ITEM_STATE = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(context) {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                context.commit('RESET_ITEM_STATE');\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function RESET_ITEM_STATE(_x6) {\n        return _RESET_ITEM_STATE.apply(this, arguments);\n      }\n\n      return RESET_ITEM_STATE;\n    }()\n  };\n  this.mutations = {\n    SET_PARENT_ITEM_ID: function SET_PARENT_ITEM_ID(state, id) {\n      state.parentId = id;\n    },\n    SET_DATA_LIST: function SET_DATA_LIST(state, list) {\n      state.dataList = list;\n    },\n    SET_SIZE: function SET_SIZE(context, size) {\n      state.size = size;\n    },\n    SET_SEARCH: function SET_SEARCH(context, search) {\n      state.search = search;\n    },\n    INCREMENT_PAGE: function INCREMENT_PAGE(state) {\n      state.page++;\n    },\n    DECREMENT_PAGE: function DECREMENT_PAGE(state) {\n      state.page--;\n    },\n    PATCH_ITEM_PERMISSIONS: function PATCH_ITEM_PERMISSIONS(state, _ref2) {\n      var prop = _ref2.prop,\n          index = _ref2.index;\n\n      // if 'read' checkbox switches to false, make all operations false\n      if (prop === 'r' && state.dataList[index].access.r) {\n        Object.keys(state.dataList[index].access).map(function (item) {\n          state.dataList[index].access[item] = false;\n        });\n        return; // else if another operation switches to true with unactive 'read', activate 'read' too\n      } else if (!state.dataList[index].access.r && prop !== 'r') {\n        state.dataList[index].access.r = true;\n      }\n\n      state.dataList[index].access[prop] = !state.dataList[index].access[prop];\n    },\n    RESET_ITEM_STATE: function RESET_ITEM_STATE(state) {\n      Object.assign(state, defaultState());\n    }\n  };\n};",{"version":3,"sources":["/home/dev/work/client-auth/src/store/modules/defaults/DefaultPermissionsModule.js"],"names":["DefaultPermissionsModule","defaultState","state","parentId","actions","SET_PARENT_ITEM_ID","context","id","commit","LOAD_DATA_LIST","dispatch","dataList","SET_SIZE","size","SET_SEARCH","search","NEXT_PAGE","isNextPage","PREV_PAGE","page","PATCH_ITEM_PERMISSIONS","prop","index","readState","access","r","item","grantee_id","grantee","ADD_ITEM_ROLE","role","RESET_ITEM_STATE","mutations","SET_DATA_LIST","list","INCREMENT_PAGE","DECREMENT_PAGE","Object","keys","map","assign"],"mappings":"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","sourcesContent":["export class DefaultPermissionsModule {\n    constructor(defaultState) {\n        this.state = {\n            parentId: 0,\n            ...defaultState()\n        };\n\n        this.actions = {\n            SET_PARENT_ITEM_ID: (context, id) => {\n                context.commit('SET_PARENT_ITEM_ID', id);\n            },\n\n            LOAD_DATA_LIST: async (context) => {\n                if (context.state.parentId) {\n                    const dataList = await context.dispatch('LOAD_PERMISSIONS_LIST');\n                    context.dispatch('RESET_ITEM_STATE');\n                    context.commit('SET_DATA_LIST', dataList);\n                }\n            },\n\n            SET_SIZE: (context, size) => {\n                context.commit('SET_SIZE', size);\n            },\n\n            SET_SEARCH: (context, search) => {\n                context.commit('SET_SEARCH', search);\n            },\n\n            NEXT_PAGE: (context) => {\n                if (context.state.isNextPage) {\n                    context.commit('INCREMENT_PAGE');\n                    context.dispatch('LOAD_DATA_LIST');\n                }\n            },\n\n            PREV_PAGE: (context) => {\n                if (context.state.page) {\n                    context.commit('DECREMENT_PAGE');\n                    context.dispatch('LOAD_DATA_LIST');\n                }\n            },\n\n            PATCH_ITEM_PERMISSIONS: async (context, {prop, index}) => {\n                const readState = context.state.dataList[index].access.r;\n                await context.commit('PATCH_ITEM_PERMISSIONS', {prop, index});\n                let item = [{\n                    grantee_id: context.state.dataList[index].grantee.id,\n                    access: prop\n                }];\n                if (!readState) item[0].access += 'r';\n                try {\n                    await context.dispatch('PATCH_PERMISSIONS', item);\n                } catch {\n                    context.dispatch('LOAD_DATA_LIST');\n                }\n            },\n\n            ADD_ITEM_ROLE: async (context, role) => {\n                const item = [{\n                    grantee_id: role.id,\n                    access: 'r'\n                }];\n                try {\n                    await context.dispatch('PATCH_PERMISSIONS', item);\n                } catch {\n                } finally {\n                    context.dispatch('LOAD_DATA_LIST');\n                }\n            },\n\n            RESET_ITEM_STATE: async (context) => {\n                context.commit('RESET_ITEM_STATE');\n            },\n        };\n\n        this.mutations = {\n            SET_PARENT_ITEM_ID: (state, id) => {\n                state.parentId = id;\n            },\n\n            SET_DATA_LIST: (state, list) => {\n                state.dataList = list;\n            },\n\n            SET_SIZE: (context, size) => {\n                state.size = size;\n            },\n\n            SET_SEARCH: (context, search) => {\n                state.search = search;\n            },\n\n            INCREMENT_PAGE: (state) => {\n                state.page++;\n            },\n\n            DECREMENT_PAGE: (state) => {\n                state.page--;\n            },\n\n            PATCH_ITEM_PERMISSIONS: (state, {prop, index}) => {\n                // if 'read' checkbox switches to false, make all operations false\n                if (prop === 'r' && state.dataList[index].access.r) {\n                    Object.keys(state.dataList[index].access).map(item => {\n                        state.dataList[index].access[item] = false\n                    });\n                    return\n                    // else if another operation switches to true with unactive 'read', activate 'read' too\n                } else if (!state.dataList[index].access.r && prop !== 'r') {\n                    state.dataList[index].access.r = true;\n                }\n                state.dataList[index].access[prop] = !state.dataList[index].access[prop];\n\n            },\n\n            RESET_ITEM_STATE: (state) => {\n                Object.assign(state, defaultState());\n            },\n        };\n    }\n}"]}]}