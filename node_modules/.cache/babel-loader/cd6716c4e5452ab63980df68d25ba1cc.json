{"remainingRequest":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js!/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/dev/work/client-auth/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/dev/work/client-auth/src/components/lookups/media/the-media.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/dev/work/client-auth/src/components/lookups/media/the-media.vue","mtime":1581435762708},{"path":"/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.search\";\nimport _defineProperty from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport jszip from 'jszip';\nimport jszipUtils from 'jszip-utils';\nimport { saveAs } from 'file-saver';\nimport vueDropzone from 'vue2-dropzone';\nimport audioPlayer from \"../../utils/audio-player\";\nimport textToSpeechPopup from \"./media-text-to-speech-popup\";\nimport tableComponentMixin from \"../../../mixins/tableComponentMixin\";\nimport { _checkboxTableField, _actionsTableField_3 } from \"../../../utils/tableFieldPresets\";\nimport eventBus from \"../../../utils/eventBus\";\nimport { mapActions, mapState } from \"vuex\";\nimport { download } from \"../../../utils/download\";\nvar token = localStorage.getItem('access-token');\nvar BASE_URL = process.env.VUE_APP_API_URL;\nexport default {\n  name: \"the-media\",\n  mixins: [tableComponentMixin],\n  components: {\n    vueDropzone: vueDropzone,\n    audioPlayer: audioPlayer,\n    textToSpeechPopup: textToSpeechPopup\n  },\n  data: function data() {\n    return {\n      baseUrl: process.env.BASE_URL,\n      // to resolve iframe equalizer path after build\n      isLoadingFiles: false,\n      loadedCount: 0,\n      allLoadingCount: 0,\n      audioLink: '',\n      playerTriggerShow: false,\n      playingIndex: null,\n      currentlyPlaying: true,\n      dropzoneOptions: {\n        url: \"\".concat(BASE_URL, \"/storage/media?access_token=\").concat(token),\n        thumbnailWidth: 150,\n        // maxFilesize: 0.5,\n        acceptedFiles: '.mp3, .wav, .mpeg',\n        uploadMultiple: true\n      },\n      fields: [_checkboxTableField, {\n        name: 'name',\n        title: this.$t('objects.name')\n      }, {\n        name: 'createdAt',\n        title: this.$t('objects.lookups.media.createdAt')\n      }, {\n        name: 'format',\n        title: this.$t('objects.lookups.media.format')\n      }, {\n        name: 'size',\n        title: this.$t('objects.lookups.media.size')\n      }, _actionsTableField_3]\n    };\n  },\n  computed: _objectSpread({}, mapState('lookups/media', {\n    dataList: function dataList(state) {\n      return state.dataList;\n    },\n    page: function page(state) {\n      return state.page;\n    },\n    // acts like a boolean: if page is 0, there's no back page\n    isNextPage: function isNextPage(state) {\n      return state.isNextPage;\n    }\n  }), {\n    size: {\n      get: function get() {\n        return this.$store.state.lookups.media.size;\n      },\n      set: function set(value) {\n        this.setSize(value);\n      }\n    },\n    search: {\n      get: function get() {\n        return this.$store.state.lookups.media.search;\n      },\n      set: function set(value) {\n        this.setSearch(value);\n      }\n    }\n  }),\n  methods: _objectSpread({\n    downloadFile: function () {\n      var _downloadFile = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(rowId) {\n        var item, id, url;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                item = this.dataList[rowId];\n                id = item.id;\n                url = \"\".concat(BASE_URL, \"/storage/media/\").concat(id, \"/download?access_token=\").concat(token);\n                download(url, item.name);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function downloadFile(_x) {\n        return _downloadFile.apply(this, arguments);\n      }\n\n      return downloadFile;\n    }(),\n    downloadAll: function () {\n      var _downloadAll = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var zip, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _loop, _iterator, _step, file;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                zip = new jszip();\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context3.prev = 4;\n                _loop =\n                /*#__PURE__*/\n                regeneratorRuntime.mark(function _loop() {\n                  var item, id, url;\n                  return regeneratorRuntime.wrap(function _loop$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          item = _step.value;\n                          id = item.id;\n                          url = \"\".concat(BASE_URL, \"/storage/media/\").concat(id, \"/stream?access_token=\").concat(token);\n                          _context2.next = 5;\n                          return new Promise(function (resolve, reject) {\n                            return jszipUtils.getBinaryContent(url, function (err, data) {\n                              if (err) {\n                                reject();\n                              } else {\n                                zip.file(item.name, data);\n                                resolve();\n                              }\n                            });\n                          });\n\n                        case 5:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _loop);\n                });\n                _iterator = this.dataList[Symbol.iterator]();\n\n              case 7:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                return _context3.delegateYield(_loop(), \"t0\", 9);\n\n              case 9:\n                _iteratorNormalCompletion = true;\n                _context3.next = 7;\n                break;\n\n              case 12:\n                _context3.next = 18;\n                break;\n\n              case 14:\n                _context3.prev = 14;\n                _context3.t1 = _context3[\"catch\"](4);\n                _didIteratorError = true;\n                _iteratorError = _context3.t1;\n\n              case 18:\n                _context3.prev = 18;\n                _context3.prev = 19;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 21:\n                _context3.prev = 21;\n\n                if (!_didIteratorError) {\n                  _context3.next = 24;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 24:\n                return _context3.finish(21);\n\n              case 25:\n                return _context3.finish(18);\n\n              case 26:\n                _context3.next = 28;\n                return zip.generateAsync({\n                  type: 'blob'\n                });\n\n              case 28:\n                file = _context3.sent;\n                saveAs(file, 'z.zip');\n\n              case 30:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee2, this, [[4, 14, 18, 26], [19,, 21, 25]]);\n      }));\n\n      function downloadAll() {\n        return _downloadAll.apply(this, arguments);\n      }\n\n      return downloadAll;\n    }(),\n    // dropzone event on loading start\n    // used for computing files number for UI and animation start\n    onFilesAdded: function onFilesAdded(files) {\n      this.isLoadingFiles = true;\n      this.loadedCount = 0;\n      this.allLoadingCount = files.length;\n    },\n    // dropzone event firing on ech file loaded successfully\n    // used for updating loaded files number on UI\n    onFileSuccess: function onFileSuccess(file, res) {\n      this.loadedCount++;\n    },\n    // dropzone event firing on ech file load\n    // used for updating loaded files number on UI\n    onFileError: function onFileError(file, message) {\n      this.loadedCount++;\n      eventBus.$emit('notificationError', message.message);\n    },\n    // dropzone event firing on all files loaded and sended\n    // used for animation end and list update\n    onComplete: function onComplete() {\n      this.isLoadingFiles = false;\n      this.loadList();\n    },\n    play: function () {\n      var _play = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(rowId) {\n        var id;\n        return regeneratorRuntime.wrap(function _callee3$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                id = this.dataList[rowId].id;\n                this.playerTriggerShow = true;\n                this.playingIndex = rowId;\n                this.audioLink = \"\".concat(BASE_URL, \"/storage/media/\").concat(id, \"/stream?access_token=\").concat(token);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function play(_x2) {\n        return _play.apply(this, arguments);\n      }\n\n      return play;\n    }(),\n    computeDate: function computeDate(date) {\n      return new Date(+date).toLocaleDateString();\n    },\n    computeFormat: function computeFormat(format) {\n      return format.split('/').pop();\n    }\n  }, mapActions('lookups/media', {\n    loadDataList: 'LOAD_DATA_LIST',\n    loadItem: 'GET_ITEM',\n    setSize: 'SET_SIZE',\n    setSearch: 'SET_SEARCH',\n    nextPage: 'NEXT_PAGE',\n    prevPage: 'PREV_PAGE',\n    removeItem: 'REMOVE_ITEM'\n  }), {\n    computeSize: function computeSize(size, nospace, one) {\n      var sizes = ['Bytes', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB'];\n      var resultSize, f;\n      sizes.forEach(function (f, id) {\n        if (one) {\n          f = f.slice(0, 1);\n        }\n\n        var s = Math.pow(1024, id),\n            fixed;\n\n        if (size >= s) {\n          fixed = String((size / s).toFixed(1));\n\n          if (fixed.indexOf('.0') === fixed.length - 2) {\n            fixed = fixed.slice(0, -2);\n          }\n\n          resultSize = fixed + (nospace ? '' : ' ') + f;\n        }\n      }); // zero handling\n      // always prints in Bytes\n\n      if (!resultSize) {\n        f = one ? sizes[0].slice(0, 1) : sizes[0];\n        resultSize = '0' + (nospace ? '' : ' ') + f;\n      }\n\n      return resultSize;\n    }\n  })\n};",{"version":3,"sources":["the-media.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"content-wrap\">\n        <object-header\n                hide-primary-action\n        >\n            {{$t('objects.lookups.lookups')}} |\n            {{$tc('objects.lookups.media.mediaFiles', 2)}}\n        </object-header>\n\n        <!--        <textToSpeechPopup-->\n        <!--                v-if=\"popupTriggerIf\"-->\n        <!--                @close=\"popupTriggerIf = false\"-->\n        <!--        ></textToSpeechPopup>-->\n\n        <section class=\"object-content\" ref=\"object-content\">\n            <header class=\"content-header\">\n                <h3 class=\"content-title\">{{$t('objects.lookups.media.allMediaFiles')}}</h3>\n                <div class=\"content-header__actions-wrap\">\n                    <search\n                            v-model=\"search\"\n                            @filterData=\"loadList\"\n                    ></search>\n                    <i\n                            class=\"icon-icon_delete icon-action\"\n                            :class=\"{'hidden': anySelected}\"\n                            :title=\"$t('iconHints.deleteSelected')\"\n                            @click=\"deleteSelected\"\n                    ></i>\n                    <i\n                            class=\"icon-action icon-icon_download\"\n                            :title=\"$t('iconHints.downloadAll')\"\n                            @click=\"downloadAll\"\n                    ></i>\n                    <!--                    <i class=\"icon-action icon-icon_text-to-speech\" @click=\"openPopup\"></i>-->\n                    <i\n                            class=\"icon-icon_reload icon-action\"\n                            :title=\"$t('iconHints.reload')\"\n                            @click=\"loadList\"\n                    ></i>\n                </div>\n            </header>\n            <vue-dropzone\n                    id=\"dropzone\"\n                    :options=\"dropzoneOptions\"\n                    :destroy-dropzone=\"false\"\n                    use-custom-slot\n                    duplicate-check\n                    @vdropzone-files-added=\"onFilesAdded\"\n                    @vdropzone-success=\"onFileSuccess\"\n                    @vdropzone-error=\"onFileError\"\n                    @vdropzone-queue-complete=\"onComplete\"\n            >\n                <div v-show=\"isLoadingFiles\">\n                    <div class=\"progress-count\">\n                        <span>{{loadedCount}}</span>/<span>{{allLoadingCount}}</span>\n                    </div>\n                </div>\n                <div\n                        v-show=\"!isLoadingFiles\"\n                        class=\"dz-custom-message\"\n                        :title=\"$t('iconHints.upload')\"\n                >\n                    <i class=\"icon-icon_upload\"></i>\n                    <div class=\"dz-message-text\">\n                        <span class=\"dz-message-text__accent\">\n                            {{$t('objects.lookups.media.dragPlaceholder')}}\n                        </span>\n                        {{$t('objects.lookups.media.dragPlaceholderHere')}}\n                    </div>\n                </div>\n            </vue-dropzone>\n\n            <loader v-show=\"!isLoaded\"></loader>\n\n            <vuetable\n                    v-show=\"isLoaded\"\n                    :api-mode=\"false\"\n                    :fields=\"fields\"\n                    :data=\"dataList\"\n            >\n                <template slot=\"name\" slot-scope=\"props\">\n                    <div>\n                        {{dataList[props.rowIndex].name}}\n                    </div>\n                </template>\n\n                <template slot=\"createdAt\" slot-scope=\"props\">\n                    <div>\n                        {{computeDate(dataList[props.rowIndex].createdAt)}}\n                    </div>\n                </template>\n\n                <template slot=\"format\" slot-scope=\"props\">\n                    <div>\n                        {{computeFormat(dataList[props.rowIndex].mimeType)}}\n                    </div>\n                </template>\n\n                <template slot=\"size\" slot-scope=\"props\">\n                    <div>\n                        {{computeSize(dataList[props.rowIndex].size)}}\n                    </div>\n                </template>\n\n                <template slot=\"actions\" slot-scope=\"props\">\n                    <i\n                            class=\"vuetable-action icon-icon_download\"\n                            :title=\"$t('iconHints.download')\"\n                            @click=\"downloadFile(props.rowIndex)\"\n                    ></i>\n                    <div class=\"vuetable-action iframe-wrap\">\n                        <i\n                                class=\"icon-icon_play\"\n                                v-show=\"props.rowIndex !== playingIndex || !currentlyPlaying\"\n                                :title=\"$t('iconHints.play')\"\n                                @click=\"play(props.rowIndex)\"\n                        ></i>\n                        <iframe\n                                v-show=\"props.rowIndex === playingIndex && currentlyPlaying\"\n                                :src=\"`${baseUrl}animations/equalizer/eq.html`\"\n                        ></iframe>\n                    </div>\n                    <i\n                            class=\"vuetable-action icon-icon_delete\"\n                            :title=\"$t('iconHints.delete')\"\n                            @click=\"remove(props.rowIndex)\"\n                    ></i>\n                </template>\n            </vuetable>\n            <pagination\n                    v-show=\"isLoaded\"\n                    v-model=\"size\"\n                    @loadDataList=\"loadList\"\n                    @next=\"nextPage\"\n                    @prev=\"prevPage\"\n                    :isNext=\"isNextPage\"\n                    :isPrev=\"!!page\"\n            ></pagination>\n        </section>\n        <audio-player\n                v-show=\"playerTriggerShow\"\n                :file=\"audioLink\"\n                @play=\"currentlyPlaying = true\"\n                @pause=\"currentlyPlaying = false\"\n                @close=\"playerTriggerShow = false\"\n        ></audio-player>\n    </div>\n</template>\n\n<script>\n    import jszip from 'jszip';\n    import jszipUtils from 'jszip-utils';\n    import {saveAs} from 'file-saver';\n    import vueDropzone from 'vue2-dropzone';\n    import audioPlayer from '../../utils/audio-player';\n    import textToSpeechPopup from './media-text-to-speech-popup';\n    import tableComponentMixin from '../../../mixins/tableComponentMixin';\n    import {_checkboxTableField, _actionsTableField_3} from \"../../../utils/tableFieldPresets\";\n    import eventBus from \"../../../utils/eventBus\";\n    import {mapActions, mapState} from \"vuex\";\n    import {download} from \"../../../utils/download\";\n\n    const token = localStorage.getItem('access-token');\n    const BASE_URL = process.env.VUE_APP_API_URL;\n\n    export default {\n        name: \"the-media\",\n        mixins: [tableComponentMixin],\n        components: {\n            vueDropzone,\n            audioPlayer,\n            textToSpeechPopup\n        },\n        data() {\n            return {\n                baseUrl: process.env.BASE_URL, // to resolve iframe equalizer path after build\n\n                isLoadingFiles: false,\n                loadedCount: 0,\n                allLoadingCount: 0,\n                audioLink: '',\n                playerTriggerShow: false,\n                playingIndex: null,\n                currentlyPlaying: true,\n\n                dropzoneOptions: {\n                    url: `${BASE_URL}/storage/media?access_token=${token}`,\n                    thumbnailWidth: 150,\n                    // maxFilesize: 0.5,\n                    acceptedFiles: '.mp3, .wav, .mpeg',\n                    uploadMultiple: true,\n                },\n                fields: [\n                    _checkboxTableField,\n                    {name: 'name', title: this.$t('objects.name')},\n                    {name: 'createdAt', title: this.$t('objects.lookups.media.createdAt')},\n                    {name: 'format', title: this.$t('objects.lookups.media.format')},\n                    {name: 'size', title: this.$t('objects.lookups.media.size')},\n                    _actionsTableField_3,\n                ],\n            };\n        },\n\n        computed: {\n            ...mapState('lookups/media', {\n                dataList: state => state.dataList,\n                page: state => state.page, // acts like a boolean: if page is 0, there's no back page\n                isNextPage: state => state.isNextPage,\n            }),\n\n            size: {\n                get() {\n                    return this.$store.state.lookups.media.size\n                },\n                set(value) {\n                    this.setSize(value)\n                }\n            },\n\n            search: {\n                get() {\n                    return this.$store.state.lookups.media.search\n                },\n                set(value) {\n                    this.setSearch(value)\n                }\n            },\n        },\n\n        methods: {\n            async downloadFile(rowId) {\n                const item = this.dataList[rowId];\n                const id = item.id;\n                const url = `${BASE_URL}/storage/media/${id}/download?access_token=${token}`;\n                download(url, item.name);\n            },\n\n            async downloadAll() {\n                const zip = new jszip();\n                for (const item of this.dataList) {\n                    const id = item.id;\n                    const url = `${BASE_URL}/storage/media/${id}/stream?access_token=${token}`;\n                    await new Promise((resolve, reject) => jszipUtils.getBinaryContent(url, (err, data) => {\n                        if (err) {\n                            reject();\n                        } else {\n                            zip.file(item.name, data);\n                            resolve();\n                        }\n                    }));\n                }\n                const file = await zip.generateAsync({type: 'blob'});\n                saveAs(file, 'z.zip');\n            },\n\n            // dropzone event on loading start\n            // used for computing files number for UI and animation start\n            onFilesAdded(files) {\n                this.isLoadingFiles = true;\n                this.loadedCount = 0;\n                this.allLoadingCount = files.length;\n            },\n\n            // dropzone event firing on ech file loaded successfully\n            // used for updating loaded files number on UI\n            onFileSuccess(file, res) {\n                this.loadedCount++;\n            },\n\n            // dropzone event firing on ech file load\n            // used for updating loaded files number on UI\n            onFileError(file, message) {\n                this.loadedCount++;\n                eventBus.$emit('notificationError', message.message);\n            },\n\n            // dropzone event firing on all files loaded and sended\n            // used for animation end and list update\n            onComplete() {\n                this.isLoadingFiles = false;\n                this.loadList();\n            },\n\n            async play(rowId) {\n                const id = this.dataList[rowId].id;\n                this.playerTriggerShow = true;\n                this.playingIndex = rowId;\n                this.audioLink = `${BASE_URL}/storage/media/${id}/stream?access_token=${token}`;\n            },\n\n            computeDate(date) {\n                return new Date(+date).toLocaleDateString();\n            },\n\n            computeFormat(format) {\n                return format.split('/').pop();\n            },\n\n            ...mapActions('lookups/media', {\n                loadDataList: 'LOAD_DATA_LIST',\n                loadItem: 'GET_ITEM',\n                setSize: 'SET_SIZE',\n                setSearch: 'SET_SEARCH',\n                nextPage: 'NEXT_PAGE',\n                prevPage: 'PREV_PAGE',\n                removeItem: 'REMOVE_ITEM',\n            }),\n\n            computeSize(size, nospace, one) {\n                const sizes = ['Bytes', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB'];\n                let resultSize, f;\n\n                sizes.forEach((f, id) => {\n                    if (one) {\n                        f = f.slice(0, 1);\n                    }\n                    let s = Math.pow(1024, id), fixed;\n                    if (size >= s) {\n                        fixed = String((size / s).toFixed(1));\n                        if (fixed.indexOf('.0') === fixed.length - 2) {\n                            fixed = fixed.slice(0, -2);\n                        }\n                        resultSize = fixed + (nospace ? '' : ' ') + f;\n                    }\n                });\n\n                // zero handling\n                // always prints in Bytes\n                if (!resultSize) {\n                    f = (one ? sizes[0].slice(0, 1) : sizes[0]);\n                    resultSize = '0' + (nospace ? '' : ' ') + f;\n                }\n\n                return resultSize;\n            },\n        }\n    }\n</script>\n\n<style lang=\"scss\">\n    .dz-custom-message i:before {\n        color: $accent-color;\n    }\n\n    .new-file {\n        background: rgba(255, 193, 7, 0.1);\n    }\n</style>"],"sourceRoot":"src/components/lookups/media"}]}