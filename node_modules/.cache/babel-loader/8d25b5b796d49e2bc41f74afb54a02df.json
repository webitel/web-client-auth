{"remainingRequest":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js!/home/dev/work/client-auth/src/api/contact-center/queues/queueMembers.js","dependencies":[{"path":"/home/dev/work/client-auth/src/api/contact-center/queues/queueMembers.js","mtime":1580893063306},{"path":"/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport instance from \"../../instance\";\nimport configuration from \"../../openAPIConfig\";\nimport sanitizer from \"../../utils/sanitizer\";\nimport { MemberServiceApiFactory } from 'webitel-sdk';\nimport eventBus from \"../../../utils/eventBus\";\nimport deepCopy from 'deep-copy';\nimport store from \"../../../store/store\";\nvar memberService = new MemberServiceApiFactory(configuration, '', instance);\nvar fieldsToSend = ['domainId', 'queueId', 'name', 'priority', 'bucket', 'timezone', 'communications', 'variables', 'expireAt'];\nvar communicationsFieldsToSend = ['destination', 'display', 'priority', 'type', 'resource', 'description'];\nexport var getMembersList =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee(queueId) {\n    var page,\n        size,\n        search,\n        domainId,\n        defaultObject,\n        defaultObjectCommunication,\n        response,\n        _args = arguments;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            page = _args.length > 1 && _args[1] !== undefined ? _args[1] : 0;\n            size = _args.length > 2 && _args[2] !== undefined ? _args[2] : 10;\n            search = _args.length > 3 ? _args[3] : undefined;\n            domainId = store.state.userinfo.domainId || undefined;\n            if (search && search.slice(-1) !== '*') search += '*';\n            defaultObject = {\n              createdAt: 'unknown',\n              priority: '0',\n              _isSelected: false\n            };\n            defaultObjectCommunication = {\n              destination: '',\n              display: '',\n              priority: 0,\n              type: {},\n              resource: {},\n              description: ''\n            };\n            _context.prev = 7;\n            _context.next = 10;\n            return memberService.searchMember(queueId, page, size, domainId);\n\n          case 10:\n            response = _context.sent;\n\n            if (!response.items) {\n              _context.next = 13;\n              break;\n            }\n\n            return _context.abrupt(\"return\", response.items.map(function (item) {\n              item.communications = item.communications.map(function (comm) {\n                return _objectSpread({}, defaultObjectCommunication, {}, comm);\n              });\n              return _objectSpread({}, defaultObject, {}, item);\n            }));\n\n          case 13:\n            return _context.abrupt(\"return\", []);\n\n          case 16:\n            _context.prev = 16;\n            _context.t0 = _context[\"catch\"](7);\n            throw _context.t0;\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[7, 16]]);\n  }));\n\n  return function getMembersList(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getMember =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee2(queueId, id) {\n    var domainId, defaultObject, defaultObjectCommunication, response;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            domainId = store.state.userinfo.domainId || undefined;\n            defaultObject = {\n              createdAt: 'unknown',\n              priority: '0',\n              _isSelected: false,\n              _dirty: false\n            };\n            defaultObjectCommunication = {\n              destination: '',\n              display: '',\n              priority: 0,\n              type: {},\n              resource: {},\n              description: ''\n            };\n            _context2.prev = 3;\n            _context2.next = 6;\n            return memberService.readMember(queueId, id, domainId);\n\n          case 6:\n            response = _context2.sent;\n\n            if (response.variables) {\n              response.variables = Object.keys(response.variables).map(function (key) {\n                return {\n                  key: key,\n                  value: response.variables[key]\n                };\n              });\n            }\n\n            if (response.priority) response.priority += '';\n            response.communications = response.communications.map(function (comm) {\n              return _objectSpread({}, defaultObjectCommunication, {}, comm);\n            });\n            return _context2.abrupt(\"return\", _objectSpread({}, defaultObject, {}, response));\n\n          case 13:\n            _context2.prev = 13;\n            _context2.t0 = _context2[\"catch\"](3);\n            throw _context2.t0;\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[3, 13]]);\n  }));\n\n  return function getMember(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var addMember =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee3(queueId, item) {\n    var itemCopy, response;\n    return regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            itemCopy = deepCopy(item);\n            itemCopy.domainId = store.state.userinfo.domainId || undefined;\n            itemCopy.variables = {};\n            sanitizer(itemCopy, fieldsToSend);\n            itemCopy.communications.forEach(function (item) {\n              return sanitizer(item, communicationsFieldsToSend);\n            });\n            item.variables.forEach(function (variable) {\n              itemCopy.variables[variable.key] = variable.value;\n            });\n            _context3.prev = 6;\n            _context3.next = 9;\n            return memberService.createMember(queueId, itemCopy);\n\n          case 9:\n            response = _context3.sent;\n            eventBus.$emit('notificationInfo', 'Sucessfully added');\n            return _context3.abrupt(\"return\", response.id);\n\n          case 14:\n            _context3.prev = 14;\n            _context3.t0 = _context3[\"catch\"](6);\n            throw _context3.t0;\n\n          case 17:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[6, 14]]);\n  }));\n\n  return function addMember(_x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var updateMember =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee4(queueId, id, item) {\n    var itemCopy;\n    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            itemCopy = deepCopy(item);\n            itemCopy.domainId = store.state.userinfo.domainId || undefined;\n            itemCopy.variables = {};\n            sanitizer(itemCopy, fieldsToSend);\n            itemCopy.communications.forEach(function (item) {\n              return sanitizer(item, communicationsFieldsToSend);\n            });\n            item.variables.forEach(function (variable) {\n              itemCopy.variables[variable.key] = variable.value;\n            });\n            _context4.prev = 6;\n            _context4.next = 9;\n            return memberService.updateMember(queueId, id, itemCopy);\n\n          case 9:\n            eventBus.$emit('notificationInfo', 'Sucessfully updated');\n            _context4.next = 15;\n            break;\n\n          case 12:\n            _context4.prev = 12;\n            _context4.t0 = _context4[\"catch\"](6);\n            throw _context4.t0;\n\n          case 15:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[6, 12]]);\n  }));\n\n  return function updateMember(_x6, _x7, _x8) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var deleteMember =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee5(queueId, id) {\n    var domainId;\n    return regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            domainId = store.state.userinfo.domainId || undefined;\n            _context5.prev = 1;\n            _context5.next = 4;\n            return memberService.deleteMember(queueId, id, domainId);\n\n          case 4:\n            _context5.next = 9;\n            break;\n\n          case 6:\n            _context5.prev = 6;\n            _context5.t0 = _context5[\"catch\"](1);\n            throw _context5.t0;\n\n          case 9:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[1, 6]]);\n  }));\n\n  return function deleteMember(_x9, _x10) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var addMembersList =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee6(queueId, items) {\n    var domainId, itemsCopy, body;\n    return regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            domainId = store.state.userinfo.domainId || undefined;\n            itemsCopy = deepCopy(items);\n            body = {\n              queueId: queueId,\n              items: itemsCopy,\n              domainId: domainId\n            };\n            _context6.prev = 3;\n            _context6.next = 6;\n            return memberService.createMemberBulk(queueId, body);\n\n          case 6:\n            eventBus.$emit('notificationInfo', 'Sucessfully added');\n            _context6.next = 12;\n            break;\n\n          case 9:\n            _context6.prev = 9;\n            _context6.t0 = _context6[\"catch\"](3);\n            throw _context6.t0;\n\n          case 12:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6, null, [[3, 9]]);\n  }));\n\n  return function addMembersList(_x11, _x12) {\n    return _ref6.apply(this, arguments);\n  };\n}();",{"version":3,"sources":["/home/dev/work/client-auth/src/api/contact-center/queues/queueMembers.js"],"names":["instance","configuration","sanitizer","MemberServiceApiFactory","eventBus","deepCopy","store","memberService","fieldsToSend","communicationsFieldsToSend","getMembersList","queueId","page","size","search","domainId","state","userinfo","undefined","slice","defaultObject","createdAt","priority","_isSelected","defaultObjectCommunication","destination","display","type","resource","description","searchMember","response","items","map","item","communications","comm","getMember","id","_dirty","readMember","variables","Object","keys","key","value","addMember","itemCopy","forEach","variable","createMember","$emit","updateMember","deleteMember","addMembersList","itemsCopy","body","createMemberBulk"],"mappings":"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","sourcesContent":["import instance from '../../instance';\nimport configuration from '../../openAPIConfig';\nimport sanitizer from '../../utils/sanitizer';\nimport {MemberServiceApiFactory} from 'webitel-sdk';\nimport eventBus from \"../../../utils/eventBus\";\nimport deepCopy from 'deep-copy';\nimport store from '../../../store/store';\n\nconst memberService = new MemberServiceApiFactory\n(configuration, '', instance);\n\nconst fieldsToSend = ['domainId', 'queueId', 'name', 'priority', 'bucket', 'timezone', 'communications',\n    'variables', 'expireAt'];\n\nconst communicationsFieldsToSend = ['destination', 'display', 'priority', 'type', 'resource', 'description'];\n\nexport const getMembersList = async (queueId, page = 0, size = 10, search) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n    if (search && search.slice(-1) !== '*') search += '*';\n    const defaultObject = {\n        createdAt: 'unknown',\n        priority: '0',\n        _isSelected: false,\n    };\n\n    const defaultObjectCommunication = {\n        destination: '',\n        display: '',\n        priority: 0,\n        type: {},\n        resource: {},\n        description: '',\n    };\n\n    try {\n        const response = await memberService.searchMember(queueId, page, size, domainId);\n        if (response.items) {\n            return response.items.map(item => {\n                item.communications = item.communications.map(comm => {\n                    return {...defaultObjectCommunication, ...comm}\n                });\n                return {...defaultObject, ...item};\n            });\n        }\n        return [];\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const getMember = async (queueId, id) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n\n    const defaultObject = {\n        createdAt: 'unknown',\n        priority: '0',\n        _isSelected: false,\n        _dirty: false,\n    };\n\n    const defaultObjectCommunication = {\n        destination: '',\n        display: '',\n        priority: 0,\n        type: {},\n        resource: {},\n        description: '',\n    };\n\n    try {\n        let response = await memberService.readMember(queueId, id, domainId);\n        if (response.variables) {\n            response.variables = Object.keys(response.variables).map(key => {\n                return {key, value: response.variables[key],}\n            });\n        }\n        if (response.priority) response.priority += '';\n        response.communications = response.communications.map(comm => {\n            return {...defaultObjectCommunication, ...comm}\n        });\n        return {...defaultObject, ...response};\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const addMember = async (queueId, item) => {\n    let itemCopy = deepCopy(item);\n    itemCopy.domainId = store.state.userinfo.domainId || undefined;\n    itemCopy.variables = {};\n    sanitizer(itemCopy, fieldsToSend);\n    itemCopy.communications.forEach(item => sanitizer(item, communicationsFieldsToSend));\n    item.variables.forEach(variable => {\n        itemCopy.variables[variable.key] = variable.value;\n    });\n    try {\n        const response = await memberService.createMember(queueId, itemCopy);\n        eventBus.$emit('notificationInfo', 'Sucessfully added');\n        return response.id;\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const updateMember = async (queueId, id, item) => {\n    let itemCopy = deepCopy(item);\n    itemCopy.domainId = store.state.userinfo.domainId || undefined;\n    itemCopy.variables = {};\n    sanitizer(itemCopy, fieldsToSend);\n    itemCopy.communications.forEach(item => sanitizer(item, communicationsFieldsToSend));\n    item.variables.forEach(variable => {\n        itemCopy.variables[variable.key] = variable.value;\n    });\n    try {\n        await memberService.updateMember(queueId, id, itemCopy);\n        eventBus.$emit('notificationInfo', 'Sucessfully updated');\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const deleteMember = async (queueId, id) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n    try {\n        await memberService.deleteMember(queueId, id, domainId);\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const addMembersList = async (queueId, items) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n    let itemsCopy = deepCopy(items);\n    let body = {queueId, items: itemsCopy, domainId};\n    try {\n        await memberService.createMemberBulk(queueId, body);\n        eventBus.$emit('notificationInfo', 'Sucessfully added');\n    } catch (err) {\n        throw err;\n    }\n};"]}]}