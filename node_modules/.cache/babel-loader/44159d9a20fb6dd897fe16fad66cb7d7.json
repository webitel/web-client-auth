{"remainingRequest":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js!/home/dev/work/client-auth/src/api/lookups/calendars/calendars.js","dependencies":[{"path":"/home/dev/work/client-auth/src/api/lookups/calendars/calendars.js","mtime":1580894541432},{"path":"/home/dev/work/client-auth/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dev/work/client-auth/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/dev/work/client-auth/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport instance from \"../../instance\";\nimport configuration from \"../../openAPIConfig\";\nimport { CalendarServiceApiFactory } from 'webitel-sdk';\nimport sanitizer from \"../../utils/sanitizer\";\nimport { coerceObjectPermissionsResponse } from \"../../permissions/objects/objects\";\nimport eventBus from \"../../../utils/eventBus\";\nimport deepCopy from 'deep-copy';\nimport store from \"../../../store/store\";\nvar calendarService = new CalendarServiceApiFactory(configuration, '', instance);\nvar BASE_URL = '/calendars';\nvar fieldsToSend = ['domainId', 'name', 'description', 'timezone', 'startAt', 'endAt', 'day', 'accepts', 'excepts', 'startTimeOfDay', 'endTimeOfDay', 'disabled', 'date', 'repeat'];\nexport var getCalendarList =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee() {\n    var page,\n        size,\n        search,\n        domainId,\n        defaultObject,\n        response,\n        _args = arguments;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            page = _args.length > 0 && _args[0] !== undefined ? _args[0] : 0;\n            size = _args.length > 1 && _args[1] !== undefined ? _args[1] : 10;\n            search = _args.length > 2 ? _args[2] : undefined;\n            domainId = store.state.userinfo.domainId || undefined;\n            if (search && search.slice(-1) !== '*') search += '*';\n            defaultObject = {\n              _isSelected: false\n            };\n            _context.prev = 6;\n            _context.next = 9;\n            return calendarService.searchCalendar(page, size, search, domainId);\n\n          case 9:\n            response = _context.sent;\n\n            if (!response.items) {\n              _context.next = 12;\n              break;\n            }\n\n            return _context.abrupt(\"return\", response.items.map(function (item) {\n              return _objectSpread({}, defaultObject, {}, item);\n            }));\n\n          case 12:\n            return _context.abrupt(\"return\", []);\n\n          case 15:\n            _context.prev = 15;\n            _context.t0 = _context[\"catch\"](6);\n            throw _context.t0;\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[6, 15]]);\n  }));\n\n  return function getCalendarList() {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getCalendar =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee2(id) {\n    var domainId, response, defaultObject;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            domainId = store.state.userinfo.domainId || undefined;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return calendarService.readCalendar(id, domainId);\n\n          case 4:\n            response = _context2.sent;\n            defaultObject = {\n              name: '',\n              timezone: {},\n              description: '',\n              startAt: Date.now(),\n              endAt: Date.now(),\n              expires: !!(response.startAt || response.endAt),\n              accepts: [],\n              excepts: [],\n              _dirty: false\n            };\n            response.accepts = response.accepts.map(function (accept) {\n              return {\n                day: accept.day || 0,\n                disabled: accept.disabled || false,\n                start: accept.startTimeOfDay || 0,\n                end: accept.endTimeOfDay || 0\n              };\n            });\n            return _context2.abrupt(\"return\", _objectSpread({}, defaultObject, {}, response));\n\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](1);\n            throw _context2.t0;\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[1, 10]]);\n  }));\n\n  return function getCalendar(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var getCalendarTimezones =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee3() {\n    var page,\n        size,\n        search,\n        response,\n        _args3 = arguments;\n    return regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            page = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 0;\n            size = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : 20;\n            search = _args3.length > 2 ? _args3[2] : undefined;\n            if (search && search.slice(-1) !== '*') search += '*';\n            if (search && search.slice(0) !== '*') search = '*' + search;\n            _context3.prev = 5;\n            _context3.next = 8;\n            return calendarService.searchTimezones(page, size, search);\n\n          case 8:\n            response = _context3.sent;\n            return _context3.abrupt(\"return\", response.items);\n\n          case 12:\n            _context3.prev = 12;\n            _context3.t0 = _context3[\"catch\"](5);\n            throw _context3.t0;\n\n          case 15:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[5, 12]]);\n  }));\n\n  return function getCalendarTimezones() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var addCalendar =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee4(item) {\n    var itemCopy, response;\n    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            itemCopy = deepCopy(item);\n            itemCopy.domainId = store.state.userinfo.domainId || undefined;\n            delete itemCopy.timezone.offset;\n\n            if (!itemCopy.expires) {\n              delete itemCopy.startAt;\n              delete itemCopy.endAt;\n            }\n\n            itemCopy.accepts = itemCopy.accepts.map(function (accept) {\n              return {\n                day: accept.day,\n                disabled: accept.disabled,\n                startTimeOfDay: accept.start,\n                endTimeOfDay: accept.end\n              };\n            });\n            sanitizer(itemCopy, fieldsToSend);\n            _context4.prev = 6;\n            _context4.next = 9;\n            return calendarService.createCalendar(itemCopy);\n\n          case 9:\n            response = _context4.sent;\n            return _context4.abrupt(\"return\", response.id);\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t0 = _context4[\"catch\"](6);\n            throw _context4.t0;\n\n          case 16:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[6, 13]]);\n  }));\n\n  return function addCalendar(_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var updateCalendar =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee5(itemId, item) {\n    var itemCopy;\n    return regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            itemCopy = deepCopy(item);\n            itemCopy.domainId = store.state.userinfo.domainId || undefined;\n            delete itemCopy.timezone.offset;\n\n            if (!itemCopy.expires) {\n              delete itemCopy.startAt;\n              delete itemCopy.endAt;\n            }\n\n            itemCopy.accepts = itemCopy.accepts.map(function (accept) {\n              return {\n                day: accept.day,\n                disabled: accept.disabled,\n                startTimeOfDay: accept.start,\n                endTimeOfDay: accept.end\n              };\n            });\n            sanitizer(itemCopy, fieldsToSend);\n            _context5.prev = 6;\n            _context5.next = 9;\n            return calendarService.updateCalendar(itemId, itemCopy);\n\n          case 9:\n            _context5.next = 14;\n            break;\n\n          case 11:\n            _context5.prev = 11;\n            _context5.t0 = _context5[\"catch\"](6);\n            throw _context5.t0;\n\n          case 14:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[6, 11]]);\n  }));\n\n  return function updateCalendar(_x3, _x4) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var deleteCalendar =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee6(id) {\n    var domainId;\n    return regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            domainId = store.state.userinfo.domainId || undefined;\n            _context6.prev = 1;\n            _context6.next = 4;\n            return calendarService.deleteCalendar(id, domainId);\n\n          case 4:\n            _context6.next = 9;\n            break;\n\n          case 6:\n            _context6.prev = 6;\n            _context6.t0 = _context6[\"catch\"](1);\n            throw _context6.t0;\n\n          case 9:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6, null, [[1, 6]]);\n  }));\n\n  return function deleteCalendar(_x5) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nexport var getCalendarPermissions =\n/*#__PURE__*/\nfunction () {\n  var _ref7 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee7(id) {\n    var page,\n        size,\n        search,\n        url,\n        response,\n        _args7 = arguments;\n    return regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            page = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : 0;\n            size = _args7.length > 2 && _args7[2] !== undefined ? _args7[2] : 10;\n            search = _args7.length > 3 ? _args7[3] : undefined;\n            // let url = BASE_URL + `?page=${page}size=${size}`;\n            url = BASE_URL + '/' + id + '/acl' + \"?size=\".concat(size);\n            if (search) url += \"&name=\".concat(search, \"*\");\n            _context7.prev = 5;\n            _context7.next = 8;\n            return instance.get(url);\n\n          case 8:\n            response = _context7.sent;\n            return _context7.abrupt(\"return\", coerceObjectPermissionsResponse(response));\n\n          case 12:\n            _context7.prev = 12;\n            _context7.t0 = _context7[\"catch\"](5);\n            throw _context7.t0;\n\n          case 15:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[5, 12]]);\n  }));\n\n  return function getCalendarPermissions(_x6) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nexport var patchCalendarPermissions =\n/*#__PURE__*/\nfunction () {\n  var _ref8 = _asyncToGenerator(\n  /*#__PURE__*/\n  regeneratorRuntime.mark(function _callee8(id, item) {\n    var url;\n    return regeneratorRuntime.wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            url = BASE_URL + '/' + id + '/acl';\n            _context8.prev = 1;\n            _context8.next = 4;\n            return instance.patch(url, {\n              changes: item\n            });\n\n          case 4:\n            eventBus.$emit('notificationInfo', 'Sucessfully updated');\n            _context8.next = 10;\n            break;\n\n          case 7:\n            _context8.prev = 7;\n            _context8.t0 = _context8[\"catch\"](1);\n            throw _context8.t0;\n\n          case 10:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[1, 7]]);\n  }));\n\n  return function patchCalendarPermissions(_x7, _x8) {\n    return _ref8.apply(this, arguments);\n  };\n}();",{"version":3,"sources":["/home/dev/work/client-auth/src/api/lookups/calendars/calendars.js"],"names":["instance","configuration","CalendarServiceApiFactory","sanitizer","coerceObjectPermissionsResponse","eventBus","deepCopy","store","calendarService","BASE_URL","fieldsToSend","getCalendarList","page","size","search","domainId","state","userinfo","undefined","slice","defaultObject","_isSelected","searchCalendar","response","items","map","item","getCalendar","id","readCalendar","name","timezone","description","startAt","Date","now","endAt","expires","accepts","excepts","_dirty","accept","day","disabled","start","startTimeOfDay","end","endTimeOfDay","getCalendarTimezones","searchTimezones","addCalendar","itemCopy","offset","createCalendar","updateCalendar","itemId","deleteCalendar","getCalendarPermissions","url","get","patchCalendarPermissions","patch","changes","$emit"],"mappings":"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","sourcesContent":["import instance from '../../instance';\nimport configuration from '../../openAPIConfig';\nimport {CalendarServiceApiFactory} from 'webitel-sdk';\nimport sanitizer from \"../../utils/sanitizer\";\nimport {coerceObjectPermissionsResponse} from \"../../permissions/objects/objects\";\nimport eventBus from \"../../../utils/eventBus\";\nimport deepCopy from 'deep-copy';\nimport store from '../../../store/store';\n\nconst calendarService = new CalendarServiceApiFactory\n(configuration, '', instance);\n\nconst BASE_URL = '/calendars';\nconst fieldsToSend = ['domainId', 'name', 'description', 'timezone', 'startAt', 'endAt', 'day',\n    'accepts', 'excepts', 'startTimeOfDay', 'endTimeOfDay', 'disabled', 'date', 'repeat'];\n\nexport const getCalendarList = async (page = 0, size = 10, search) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n    if (search && search.slice(-1) !== '*') search += '*';\n    const defaultObject = {\n        _isSelected: false,\n    };\n\n    try {\n        const response = await calendarService.searchCalendar(page, size, search, domainId);\n        if (response.items) {\n            return response.items.map(item => {\n                return {...defaultObject, ...item};\n            });\n        }\n        return [];\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const getCalendar = async (id) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n\n    try {\n        let response = await calendarService.readCalendar(id, domainId);\n        const defaultObject = {\n            name: '',\n            timezone: {},\n            description: '',\n            startAt: Date.now(),\n            endAt: Date.now(),\n            expires: !!(response.startAt || response.endAt),\n            accepts: [],\n            excepts: [],\n            _dirty: false,\n        };\n        response.accepts = response.accepts.map(accept => {\n            return {\n                day: accept.day || 0,\n                disabled: accept.disabled || false,\n                start: accept.startTimeOfDay || 0,\n                end: accept.endTimeOfDay || 0\n            }\n        });\n        return {...defaultObject, ...response};\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const getCalendarTimezones = async (page = 0, size = 20, search) => {\n    if (search && search.slice(-1) !== '*') search += '*';\n    if (search && search.slice(0) !== '*') search = '*' + search;\n    try {\n        const response = await calendarService.searchTimezones(page, size, search);\n        return response.items;\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const addCalendar = async (item) => {\n    let itemCopy = deepCopy(item);\n    itemCopy.domainId = store.state.userinfo.domainId || undefined;\n    delete itemCopy.timezone.offset;\n    if (!itemCopy.expires) {\n        delete itemCopy.startAt;\n        delete itemCopy.endAt;\n    }\n\n    itemCopy.accepts = itemCopy.accepts.map(accept => {\n        return {\n            day: accept.day,\n            disabled: accept.disabled,\n            startTimeOfDay: accept.start,\n            endTimeOfDay: accept.end\n        }\n    });\n    sanitizer(itemCopy, fieldsToSend);\n    try {\n        const response = await calendarService.createCalendar(itemCopy);\n        return response.id;\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const updateCalendar = async (itemId, item) => {\n    let itemCopy = deepCopy(item);\n    itemCopy.domainId = store.state.userinfo.domainId || undefined;\n    delete itemCopy.timezone.offset;\n    if (!itemCopy.expires) {\n        delete itemCopy.startAt;\n        delete itemCopy.endAt;\n    }\n\n    itemCopy.accepts = itemCopy.accepts.map(accept => {\n        return {\n            day: accept.day,\n            disabled: accept.disabled,\n            startTimeOfDay: accept.start,\n            endTimeOfDay: accept.end\n        }\n    });\n    sanitizer(itemCopy, fieldsToSend);\n    try {\n        await calendarService.updateCalendar(itemId, itemCopy);\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const deleteCalendar = async (id) => {\n    const domainId = store.state.userinfo.domainId || undefined;\n    try {\n        await calendarService.deleteCalendar(id, domainId);\n    } catch (err) {\n        throw err;\n    }\n};\n\nexport const getCalendarPermissions = async (id, page = 0, size = 10, search) => {\n    // let url = BASE_URL + `?page=${page}size=${size}`;\n    let url = BASE_URL + '/' + id + '/acl' + `?size=${size}`;\n    if (search) url += `&name=${search}*`;\n    try {\n        const response = await instance.get(url);\n        return coerceObjectPermissionsResponse(response);\n    } catch (error) {\n        throw error;\n    }\n};\n\nexport const patchCalendarPermissions = async (id, item) => {\n    const url = BASE_URL + '/' + id + '/acl';\n\n    try {\n        await instance.patch(url, {changes: item});\n        eventBus.$emit('notificationInfo', 'Sucessfully updated');\n    } catch (error) {\n        throw error;\n    }\n};"]}]}